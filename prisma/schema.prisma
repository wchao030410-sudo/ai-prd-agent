// AI PRD Agent Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 会话：保存用户的对话会话
model Session {
  id          String   @id @default(cuid())
  title       String
  prdId       String?  @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  messages    Message[]
  prd         PRD?
}

// 消息：保存对话历史
model Message {
  id        String   @id @default(cuid())
  role      String   // user | assistant | system
  content   String
  sessionId String
  createdAt DateTime @default(now())
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

// PRD 文档：保存生成的产品需求文档
model PRD {
  id          String   @id @default(cuid())
  sessionId   String?  @unique
  title       String
  description String
  background  String?
  targetUsers String   // JSON: { primary: [], secondary: [] }
  painPoints  String?  // JSON: []
  coreValue   String?  // JSON: []
  features    String   // JSON: [{ id, name, description, priority, effort, value, acceptanceCriteria }]
  successMetrics String? // JSON: []
  techFeasibility String? // JSON: { overall, challenges, recommendations }
  competitors String? // JSON: [{ name, features, differences }]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  session     Session? @relation(fields: [sessionId], references: [id])
}

// 分析日志：记录竞品分析、可行性分析等
model AnalysisLog {
  id        String   @id @default(cuid())
  type      String   // competitor | feasibility | priority
  input     String
  output    String
  createdAt DateTime @default(now())
}
